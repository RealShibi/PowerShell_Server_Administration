# Log_Cleaning.ps1

## Synopsis
Cleans up log files in a specified directory that are older than a specified number of days.

## Description
The `Log_Cleaning.ps1` script deletes log files with a specific file extension in a given directory that are older than a specified number of days. It logs the script's actions and errors to a transcript file and exports details of deleted files to a CSV file.

## Parameters

### `-Path` (String, Mandatory)
The path to the directory or file to be cleaned.

### `-Days` (Int32, Mandatory)
The number of days to use as the threshold for deleting files. Files older than this number of days will be deleted.

### `-FileEnding` (String, Mandatory)
The file extension of the log files to be deleted.

### `-csvpath` (String, Optional, Default: `$PSScriptRoot\output.csv`)
The path to the CSV file where the output will be saved.

### `-encoding` (String, Optional, Default: `UTF8`)
The encoding to be used for the CSV file.
Valid options: `UTF8`, `ASCII`, `UTF7`, `UTF32`, `Default`, `Unicode`.

### `-delimiter` (String, Optional, Default: `;`)
The delimiter to be used in the CSV file.
Valid options: `;`, `,`, `` `t`` (tab), `|`.

## Examples

### Example 1

`powershell`
`.\Log_Cleaning.ps1 -Path "C:\Logs" -Days 30 -FileEnding "log"`

This example deletes all `.log` files in the `C:\Logs` directory that are older than 30 days.

## Notes

- **Author:** RealShibi
- **Date:** 2024-09-28
- **Version:** 1.0
- **Requirements:** PowerShell Version: 7.0 or higher
- **Required Modules:** (Optional)

### Script Details

The script performs the following actions:

#### Initialization:

- Starts a transcript log.
- Records the start time.
- Checks if PowerShell 7 or higher is running.
- (Optional) Checks for required modules.

#### Processing:

- Validates the provided path.
- Determines if the path is a file or directory.
- Retrieves files matching the specified file extension.
- Filters files older than the specified number of days.
- Deletes the old files.
- Logs actions and errors.

#### Finalization:

- Records the finish time.
- Calculates the elapsed time.
- Exports details of deleted files to a CSV file if any files were deleted.
- Stops the transcript log.

## Usage

### Prerequisites

- PowerShell 7 or higher must be installed.
- (Optional) Ensure any required modules are installed if you have uncommented the module checks.
### Running the Script

**Open PowerShell:**  
Launch a PowerShell 7 terminal.

**Navigate to Script Directory:**  
Change to the directory containing `Log_Cleaning.ps1`.

**Execute the Script:**

```powershell
.\Log_Cleaning.ps1 -Path "<YourPath>" -Days <NumberOfDays> -FileEnding "<FileExtension>"
```

Replace `<YourPath>`, `<NumberOfDays>`, and `<FileExtension>` with your specific values.
### Parameter Details

- **`-Path`:** Specify the directory or file path to clean.
- **`-Days`:** Specify the age threshold in days. Files older than this will be deleted.
- **`-FileEnding`:** Specify the file extension (without the dot) of files to delete (e.g., "log").
- **`-csvpath`:** (Optional) Specify the path for the CSV output file.
- **`-encoding`:** (Optional) Specify the encoding for the CSV file. Defaults to "UTF8".
- **`-delimiter`:** (Optional) Specify the delimiter for the CSV file. Defaults to ";".

### Logging and Output

**Transcript Log:**  
A log file named `Log_Cleaning_<timestamp>.LastRun.log` is created in the script directory.

**CSV File:**  
If files are deleted, a CSV file is generated at the path specified by `-csvpath`, containing:

- FileName
- FullPath
- LastWriteTime
- DeletedAt
### Error Handling

The script includes functions to handle errors (`Handle-Error`) and log information (`Log-Information`).  
Errors are written to the error stream, and detailed information is logged for troubleshooting.
### Customization

**Verbose Logging:**  
Uncomment the line `# $VerbosePreference = 'Continue'` to enable verbose messages.

**Module Checks:**  
Uncomment and specify modules in the `$requiredModules` array and the `Check-RequiredModules` function to enforce module requirements.

This file is generated by AI